<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0c10" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192-rounded.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512-rounded.png" />
  <link rel="manifest" href="/Tuttorly-Lite/manifest.webmanifest" />
  <title>Tuttorly ‚Äî Minimal Demo</title>
  <style>
    :root{
      --bg:#0b0c10;
      --phone:#111216;
      --card:#181a1f;
      --muted:#9aa3ad;
      --text:#e9ecf1;
      --accent:#5dd7ef;
      --accent-2:#8b5cf6;
      --danger:#ef4444;
      --ok:#22c55e;
      --okbg:rgba(34,197,94,.12);
      --okbor:rgba(34,197,94,.45);
      --dangbg:rgba(239,68,68,.12);
      --dangbor:rgba(239,68,68,.45);
      --border:rgba(255,255,255,0.08);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --goodbg:rgba(34,197,94,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 800px at 10% 10%,rgba(139,92,246,.25),transparent),
                           radial-gradient(900px 700px at 90% 80%,rgba(110,231,255,.2),transparent),
                           var(--bg);
      color:var(--text); font:500 16px/1.4 system-ui, Segoe UI, Roboto, Inter, Arial;
      display:grid; place-items:center; padding:24px;
      overflow:hidden;
      user-select:none;
      -webkit-user-select:none;
      -moz-user-select:none;
      -ms-user-select:none;
    }

    /* SPLASH */
    .splash{position:fixed; inset:0; display:grid; place-items:center; z-index:20;
      background:radial-gradient(1200px 800px at 10% 10%,rgba(139,92,246,.25),transparent),
                 radial-gradient(900px 700px at 90% 80%,rgba(110,231,255,.2),transparent),
                 var(--bg);
      animation: splashFade 1.2s ease 1.2s forwards;
    }
    .splash-logo{font-weight:900; font-size:48px; letter-spacing:.6px;
      background:linear-gradient(135deg, #d4d4d8 0%, #e4e4e7 50%, #d4d4d8 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      animation: popIn .8s ease;
    }
    @keyframes popIn{from{transform:scale(.9); opacity:0} to{transform:scale(1); opacity:1}}
    @keyframes splashFade{to{opacity:0; visibility:hidden}}

    /* PHONE MOCKUP */
    .phone{ width:380px; height:760px; background:var(--phone);
      border-radius:40px; position:relative; box-shadow:var(--shadow);
      border:1px solid var(--border); padding:18px; display:flex; flex-direction:column;
      opacity:0; transition:opacity .6s ease; }
    .phone.show{opacity:1}
    .notch{position:absolute; top:10px; left:50%; transform:translateX(-50%);
      width:140px; height:22px; background:#0c0d11; border-radius:0 0 14px 14px; border:1px solid var(--border);}    
    .screen{flex:1; background:linear-gradient(180deg,#0f1117, #0c0e12 60%);
      border-radius:28px; padding:16px; overflow:auto; display:flex; flex-direction:column; border:1px solid var(--border); scroll-behavior:smooth; scrollbar-width:none;}
    .screen::-webkit-scrollbar{display:none}

    /* APP CHROME */
    .appbar{display:flex; align-items:center; gap:10px; padding:2px 6px 6px 6px; justify-content:space-between}
    .appbar-left{display:flex; align-items:center; gap:10px; flex:0}
    .appbar-center{display:flex; align-items:center; justify-content:center; flex:1}
    .appbar-right{display:flex; align-items:center; gap:10px; flex:0}
    .logo{width:28px; height:28px; border-radius:9px; background:linear-gradient(145deg,#1a2847,#0f1626); display:grid; place-items:center; font-weight:800; color:var(--text)}
    .title{font-weight:800; letter-spacing:.2px; color:var(--text); font-size:18px}
    .spacer{flex:1}
    .iconbtn{width:38px; height:38px; border-radius:12px; display:grid; place-items:center; cursor:pointer; border:1px solid var(--border); background:#151821}
    .iconbtn svg{width:18px; height:18px; fill:currentColor; color:var(--text)}
    .iconbtn.ghost{background:transparent}
    .iconbtn.primary{
      /* Upodobnione do FAB (+) */
      background:linear-gradient(145deg, #1a2847, #0f1626);
      border:none;
      border-radius:14px;
      color:var(--text);
      box-shadow:0 10px 22px rgba(0,0,0,.35);
      transition:transform .08s ease, filter .15s ease;
    }
    .iconbtn.primary svg{color:var(--text)}
    .iconbtn.primary:hover{filter:brightness(1.05)}
    .iconbtn.primary:active{transform:scale(.97)} 

    /* BADGE */
    .tabs{display:flex; gap:8px; margin:8px 0 12px; cursor:pointer}
    .tab{flex:1; text-align:center; padding:10px; border-radius:12px; border:1px solid var(--border); color:var(--muted); cursor:pointer; transition:all .15s ease}
    .tab:hover{background:rgba(255,255,255,.04)}
    .tab.active{background:linear-gradient(180deg,rgba(139,92,246,.17),rgba(110,231,255,.12)); color:var(--text)}

    /* VIEWS */
    .view{display:none !important; flex-direction:column; gap:10px; flex:1; overflow:auto; animation:fadeIn .3s ease}
    .view.active{display:flex !important}
    @keyframes fadeIn{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:translateY(0)}}
    
    /* Smooth transitions for swipe navigation */
    .phone{transition:none}
    .view{transition:opacity .3s ease, transform .3s ease}

    /* LIST */
    .list{display:flex; flex-direction:column; gap:10px; overflow:visible; padding-right:4px; padding-bottom:70px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:12px; display:flex; gap:12px; align-items:center; cursor:pointer; transition:transform .05s ease, background .15s}
    .card:hover{background:#1a1e27}
    .card:active{transform:scale(.995)}
    .drag-handle{display:flex; align-items:center; padding:0 8px 0 4px; cursor:grab; color:var(--muted); opacity:0.1; touch-action:none}
    .drag-handle svg{width:24px; height:24px; pointer-events:none}
    .card.dragging {cursor:grabbing}
    .card.dragging .drag-handle{cursor:grabbing}
    .card.dragging{opacity:.85; box-shadow:0 12px 28px rgba(0,0,0,.4);}
    .placeholder{border:2px dashed rgba(255,255,255,.15); border-radius:16px; height:68px; margin:4px 0}
    .avatar{width:44px; height:44px; border-radius:14px; background:linear-gradient(145deg,#1f2430,#111319); display:grid; place-items:center; color:var(--muted); font-weight:700; overflow:hidden}
    .avatar img{width:100%; height:100%; object-fit:cover}
    .meta{flex:1}
    .meta .name{font-weight:700}
    .meta .sub{color:var(--muted); font-size:12px}
    .amount{font-weight:800}
    .amount.pos{color:var(--ok)}
    .amount.neg{color:var(--danger)}

    /* DETAIL */
    .detail{display:none; flex-direction:column; gap:12px; min-height:100%; align-items:center; text-align:center}
    .detail > *:not(.actions):not(.amountRow):not(.detailTop):not(.map-wrap){width:100%; max-width:280px; margin:0 auto}
    .detail > .detailTop{width:100%; padding:0 12px}
    .detail .actions, .detail .amountRow{width:100%; max-width:280px; margin:0 auto}
    .detail .map-wrap{width:100%; max-width:340px; margin:0 auto}
    .row{display:flex; gap:8px; justify-content:center}
    .detailTop{display:flex; align-items:center; justify-content:space-between; width:100%}
    input, textarea, select, button{ font:inherit; }
    input, textarea, select{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:#101219; color:var(--text); user-select:text; -webkit-user-select:text; -moz-user-select:text; -ms-user-select:text;}    
    textarea{min-height:92px; resize:vertical}
    .readonly input, .readonly textarea, .readonly select{opacity:.75; pointer-events:none}
    .readonly #dLocation{opacity:.5; pointer-events:none}
    .readonly #customAmount{opacity:1; pointer-events:auto}
    
    /* NOTES EXPANDABLE */
    .notesExpandable{border:1px solid var(--border); border-radius:12px; padding:12px; background:#0f1218; cursor:pointer; display:flex; flex-direction:column; align-items:flex-start; user-select:none; text-align:left; color:var(--muted); max-height:100px; overflow:hidden; transition:max-height .3s ease, background .2s ease}
    .notesExpandable:hover{background:#151821}
    .notesExpandable.expanded{background:linear-gradient(145deg,#1a1e27,#131820); color:var(--text); max-height:none; overflow:visible}
    .notesContent{margin:0; font-family:inherit; white-space:pre-wrap; word-wrap:break-word; font-size:14px; color:inherit; line-height:1.5; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; text-overflow:ellipsis; width:100%}
    .notesContent.show{display:block; -webkit-line-clamp:unset; overflow:visible; text-overflow:unset}

    /* HIDE number spinners */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
    input[type=number]{ -moz-appearance:textfield }

    /* ACTION BUTTONS */
    .actions{display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:4px}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; height:44px; background:#1a1e27; border:1px solid var(--border); color:#fff; padding:0 14px; border-radius:999px; cursor:pointer; transition:transform .08s ease, background .15s}
    .btn:hover{background:#1f2430}
    .btn:active{transform:scale(.98)}
    .btn.ghost{background:transparent; color:#fff}
    .btn.ok{background:var(--okbg); border-color:var(--okbor)}
    .btn.bad{background:var(--dangbg); border-color:var(--dangbor)}
    .padfix{white-space:nowrap}

    /* Equal width custom input */
    .amountRow #customAmount{ height:44px; border-radius:999px; border:1px solid var(--border); background:#1a1e27; color:var(--text); padding:0 14px; width:100%; }
    .amountRow{margin-top:4px}

    .muted{color:var(--muted)}
    .center-avatar{display:flex; justify-content:center; margin-top:8px}
    .avatar.big{width:80px; height:80px; border-radius:22px; border:2px solid rgba(255,255,255,.12); background:linear-gradient(145deg,#1f2430,#111319); box-shadow:0 10px 18px rgba(0,0,0,.28)}

    .balanceWrap{display:flex; align-items:center; gap:6px; padding:8px 10px; border-radius:12px; text-align:center}
    .balanceWrap .balanceLine{display:flex; align-items:center; justify-content:center; gap:6px; font-size:14px}
    .balanceWrap .balanceLabel{color:var(--muted)}
    .balanceWrap .requiredAmount{font-weight:700; color:var(--text)}
    .balanceWrap.highlight{background:var(--goodbg); outline:1px solid rgba(34,197,94,.3)}
    .badge{padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.12); display:flex; align-items:center; justify-content:center; text-align:center}
    .activePriceBadge{flex-direction:column; gap:2px; padding:8px 12px}

    .inputIconWrap{position:relative; width:100%}
    .inputIcon{position:absolute; left:12px; top:50%; transform:translateY(-50%); width:18px; height:18px; color:var(--muted); opacity:.7; display:grid; place-items:center; pointer-events:none}
    .inputIcon svg{width:18px; height:18px; stroke:currentColor; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round}
    .inputWithIcon{padding-left:38px}

    /* MAP */
    .map-wrap{position:relative}
    .map{border:0; width:100%; height:340px; border-radius:14px; border:1px solid var(--border); pointer-events:auto}

    /* FOOTER */
    .copyright{margin-top:12px; text-align:center; color:var(--muted); font-size:12px; padding-bottom:12px}

    /* FAB */
    .fab{position:sticky; bottom:0; left:0; right:0; width:100%; height:56px; border-radius:0 0 12px 12px; display:grid; place-items:center; cursor:pointer; background:linear-gradient(145deg,#1a2847,#0f1626); color:var(--text); font-weight:900; border:1px solid var(--border); box-shadow:0 -4px 12px rgba(0,0,0,.3); z-index:5; transition:background .3s ease; margin:0; border-top:1px solid var(--border)}
    .fab:hover{filter:brightness(1.05)}
    .fab:active{transform:scale(.98)}
    .fab.dark{background:linear-gradient(145deg,#1a2847,#0f1626); color:var(--text); border-top-color:rgba(255,255,255,.15)}

    /* MODAL */
    .dialog-wrap{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:30; padding:20px}
    .dialog{width:520px; max-width:92vw; background:#0f1218; border:1px solid var(--border); border-radius:18px; padding:12px; box-shadow:var(--shadow); max-height:85vh; overflow:auto}
    .dialog h3{margin:10px 0 8px}
    .dialog .row{margin:6px 0}
    .priceRow{display:flex; align-items:center; gap:10px}
    .priceRow .price{width:110px}
    .priceRow .label{font-size:14px; color:var(--muted)}
    .divider{display:flex; align-items:center; gap:10px; margin:10px 0 6px;}
    .divider::before, .divider::after{content:''; height:1px; background:var(--border); flex:1}
    .divider span{font-size:12px; color:var(--muted); letter-spacing:.4px}
    .footer{display:flex; justify-content:center; align-items:center; gap:10px; margin-top:14px; flex-wrap:wrap}
    .footerRight{display:flex; gap:10px}
    .btn.danger{background:linear-gradient(145deg,#ef4444,#dc2626); border-color:transparent; color:#fff; font-weight:700}
    .btn.primary{background:linear-gradient(145deg,#1a2847,#0f1626); border-color:transparent; color:var(--text); font-weight:900}

    /* Upload (avatar) */
    .upload{display:flex; align-items:center; gap:12px; border:1px dashed var(--border); border-radius:16px; padding:12px; background:#0f1218; cursor:pointer}
    .upload:hover{background:#121622}
    .upload .hint{font-size:12px; color:var(--muted)}
    .upload .sp{flex:1}
    .mini{height:36px; padding:0 12px; border-radius:999px; border:1px solid transparent; cursor:pointer}

    /* Install bar */
    .installbar{position:fixed; left:50%; transform:translateX(-50%); bottom:14px; width:min(560px,92vw); background:#0f1218; border:1px solid var(--border); border-radius:14px; padding:10px 12px; box-shadow:var(--shadow); display:none; align-items:center; gap:10px; z-index:1000}
    .installbar .label{flex:1; font-size:14px}
    .installbar .close{width:32px; height:32px; border-radius:10px; display:grid; place-items:center; border:1px solid var(--border); cursor:pointer}
    .installbar .action{height:36px; padding:0 12px; border-radius:999px; background:linear-gradient(145deg,#1a2847,#0f1626); color:var(--text); border:none; font-weight:800; cursor:pointer}

    /* Income Type Selector */
    .incomeTypeSelector{display:flex; gap:10px; margin:10px 0; justify-content:center}
    .incomeTypeBtn{flex:1; height:48px; border-radius:14px; border:1px solid var(--border); background:#1a1e27; color:var(--muted); cursor:pointer; transition:all .15s ease; font-weight:600; font-size:14px}
    .incomeTypeBtn:hover{background:#1f2430}
    .incomeTypeBtn.active{background:linear-gradient(145deg,#1a2847,#0f1626); border:none; color:var(--text); font-weight:700}

    /* Student picker */
    .studentPicker{position:relative; display:flex; flex-direction:column; width:100%}
    .studentPickerInput{width:100%; display:block}
    .studentPickerList{position:absolute; top:calc(100% + 6px); left:0; right:0; background:#0f1218; border:1px solid var(--border); border-radius:10px; max-height:180px; overflow:auto; z-index:25; display:none; box-shadow:0 6px 18px rgba(0,0,0,.25)}
    .studentPickerItem{padding:8px 10px; cursor:pointer; font-size:12px; display:flex; justify-content:space-between; gap:8px}
    .studentPickerItem:hover{background:#1a1e27}
    .studentPickerItem .muted{color:var(--muted); font-size:11px}
    .selectedStudents{display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; width:100%}
    .selectedChip{background:#1a1e27; border:1px solid var(--border); color:var(--text); padding:4px 8px; border-radius:999px; font-size:11px; display:flex; align-items:center; gap:6px}
    .selectedChip button{background:transparent; border:none; color:var(--muted); cursor:pointer; font-size:12px; line-height:1}
    .selectedChip button:hover{color:var(--text)}
    
    /* Month Selector */
    .monthBtn{padding:12px 8px; border-radius:10px; border:1px solid var(--border); background:#1a1e27; color:var(--text); cursor:pointer; transition:all .15s ease; font-size:12px; font-weight:600; text-align:center}
    .monthBtn:hover{background:#1f2430}
    .monthBtn.active{background:linear-gradient(145deg,#1a2847,#0f1626); color:var(--accent); border-color:var(--accent)}
    .monthBtn.current{border-color:var(--accent-2); color:var(--accent-2)}

    /* Year Selector */
    .monthSelectorHeader{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid var(--border)}
    .yearDisplay{font-weight:700; cursor:pointer; padding:6px 10px; border-radius:8px; border:1px solid var(--border); background:#1a1e27; transition:all .15s ease; user-select:none}
    .yearDisplay:hover{background:#1f2430}
    .yearSelectorWrap{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:40}
    .yearDropdown{width:120px; max-width:92vw; background:#0f1218; border:1px solid var(--border); border-radius:12px; padding:0; box-shadow:var(--shadow); max-height:60vh; overflow:auto; display:flex; flex-direction:column}
    .yearOption{padding:12px 16px; cursor:pointer; transition:background .15s ease; border:none; background:transparent; color:var(--text); text-align:left; font-weight:600}
    .yearOption:hover{background:#1a1e27}
    .yearOption.active{background:linear-gradient(145deg,#1a2847,#0f1626); color:var(--accent)}

    .goTodayBtn{width:100%; padding:10px 12px; background:#1a1e27; border:1px solid var(--border); color:var(--text); border-radius:10px; cursor:pointer; transition:all .15s ease; font-weight:600; font-size:13px}
    .goTodayBtn:hover{background:#1f2430}

    /* TERMINY VIEW */
    .weekContainer{display:flex; flex-direction:column; gap:0; margin-bottom:24px; padding:0 4px}
    .dayCard{display:grid; grid-template-columns:70px 1fr; gap:10px; align-items:flex-start; background:transparent; border:1px solid var(--border); padding:12px; border-radius:12px}
    .dayCard.today{border:1px solid var(--accent); background:rgba(93,215,239,.12)}
    .dayCard.empty{opacity:1}
    .dayHeader{font-weight:700; font-size:13px; color:var(--accent); letter-spacing:.1px; white-space:nowrap}
    .dayHeader.today{color:var(--accent)}
    .lessonsList{display:flex; flex-direction:column; gap:6px}
    .lessonItem{background:transparent; border:none; border-radius:0; padding:0; font-size:11px; line-height:1.6; color:var(--muted); transition:all .15s ease; cursor:pointer; display:flex; flex-direction:column}
    .lessonItem:hover{background:transparent}
    .lessonItem > div:first-child{display:flex; align-items:center; gap:10px; margin-bottom:3px}
    .lessonTime{color:var(--text); font-weight:600; font-size:11px}
    .lessonTypeAndStudent{display:flex; align-items:center; gap:6px}
    .lessonType{display:inline-block; padding:1px 5px; border-radius:3px; font-size:9px; font-weight:700; flex-shrink:0}
    .lessonType.st{background:rgba(139,92,246,.25); color:#b085f5}
    .lessonType.zd{background:rgba(110,231,255,.25); color:#6ee7ff}
    .lessonStudent{color:var(--text); font-weight:600; font-size:11px}
    .lessonNote{color:var(--muted); font-size:10px; margin-top:2px; font-style:italic; word-wrap:break-word; word-break:break-word; white-space:pre-wrap; text-align:left}
    .emptyLessonMsg{color:var(--muted); font-size:11px; text-align:center}

    .terminyActions{display:grid; grid-template-columns:1fr; gap:10px; margin-bottom:16px; justify-items:center}
    .terminyBtn{background:#1a1e27; border:1px solid var(--border); color:var(--text); padding:12px; border-radius:12px; cursor:pointer; font-weight:600; font-size:13px; transition:all .15s ease}
    .terminyBtn:hover{background:#1f2430; border-color:var(--accent)}
    .terminyBtn:active{transform:scale(.98)}

    /* MONTHLY CALENDAR */
    .monthCalendarWrap{background:#151821; border:1px solid var(--border); border-radius:14px; padding:12px; margin-top:20px}
    .monthHeader{display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; gap:10px}
    .monthNavBtn{width:32px; height:32px; border-radius:8px; border:1px solid var(--border); background:#1a1e27; color:var(--text); cursor:pointer; font-size:18px; transition:all .15s ease; display:flex; align-items:center; justify-content:center}
    .monthNavBtn:hover{background:#1f2430; border-color:var(--accent)}
    .monthTitle{flex:1; text-align:center; font-weight:800; font-size:16px; color:var(--text); text-transform:capitalize}
    .weekDaysHeader{display:grid; grid-template-columns:repeat(7,1fr); gap:6px; margin-bottom:8px; text-align:center}
    .dayHeader{color:var(--muted); font-size:11px; font-weight:700; letter-spacing:.5px; padding:6px 0}
    .monthGrid{display:grid; grid-template-columns:repeat(7,1fr); gap:6px}
    .dayCell{background:#1a1e27; border:1px solid var(--border); border-radius:10px; padding:6px 4px; text-align:center; cursor:pointer; aspect-ratio:1; display:flex; flex-direction:column; position:relative; transition:all .15s ease; justify-content:space-between; min-width:0; overflow:hidden}
    .dayCell:hover{background:#1f2430; border-color:var(--accent)}
    .dayCell.otherMonth{opacity:.3; cursor:default}
    .dayCell.otherMonth:hover{background:#1a1e27; border-color:var(--border)}
    .dayCell.today{border:1px solid rgba(228, 228, 228, 0.918); background:#1f2430}
    .dayCell.hasChange::before{content:'‚öô'; position:absolute; top:1px; right:1px; font-weight:800; color:#fff; font-size:12px; text-shadow: 0 0 8px rgba(93,215,239,.6), 0 0 16px rgba(139,92,246,.4)}
    .dayCellNumber{font-weight:700; color:var(--text); font-size:13px; margin-bottom:2px}
    .dayCellNumber.weekend{color:#ef4444}
    .dayCellIndicators{display:grid; gap:1px; width:100%; position:relative; height:auto; place-items:center}
    
    /* Lesson bar - single bar with color segments */
    .lessonBar{width:100%; height:8px; border-radius:4px; background:var(--accent); background-size:100%; box-shadow: inset 0 0 4px rgba(0,0,0,.3)}
    .lessonMoreBadge{position:absolute; left:50%; top:50%; transform:translate(-50%, -50%); font-size:8px; color:#fff; font-weight:700; z-index:10; pointer-events:none}

    /* PLAN EDIT POPUPS */
    .planEditWrap{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:60; overflow-y:auto; padding:16px 12px}
    .planEditDialog{width:100%; max-width:680px; background:#0f1218; border:1px solid var(--border); border-radius:16px; padding:14px; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:12px}
    #editPlanDaySelector{display:grid; grid-template-columns:1fr 1fr; gap:8px; max-height:56vh; overflow-y:auto; padding-right:2px}
    .planEditDialog h2{margin:0 0 8px 0; font-size:18px; color:var(--text)}
    .timeOffTitle{display:flex; align-items:center; justify-content:center; position:relative; width:100%; text-align:center}
    .timeOffTitle::before{content:'‚òï'; position:absolute; left:0}
    .timeOffTitle::after{content:'‚òï'; position:absolute; right:0}
    .dayColumnGrid{display:grid; grid-template-columns:1fr; gap:8px; max-height:auto; overflow-y:auto}
    .dayColumn{background:#1a1e27; border:1px solid var(--border); border-radius:10px; padding:8px; display:flex; flex-direction:column; gap:6px}
    .dayColumn h3{margin:0 0 6px 0; font-size:13px; color:var(--accent); font-weight:700}
    .lessonRow{background:#0f1218; border:1px solid rgba(255,255,255,.08); border-radius:8px; padding:8px; display:grid; grid-template-columns:1fr; gap:5px; font-size:11px}
    .lessonRow input, .lessonRow select{font-size:11px; padding:6px 8px; height:auto}
    .lessonRowTime{display:grid; grid-template-columns:70px 1fr; gap:6px; align-items:center}
    .lessonRowTime input{font-size:10px}
    .durationButtonGroup{display:flex; gap:2px; flex-wrap:wrap}
    .durationBtn{padding:4px 6px; font-size:9px; font-weight:600; border:1px solid rgba(93,215,239,.4); border-radius:4px; background:transparent; color:var(--muted); cursor:pointer; transition:all .15s ease; white-space:nowrap}
    .durationBtn:hover{border-color:var(--accent); color:var(--accent)}
    .durationBtn.active{background:var(--accent); color:#fff; border-color:var(--accent)}
    .lessonRowTypeStudent{display:grid; grid-template-columns:70px 1fr; gap:4px; align-items:center}
    .typeButtonGroup{display:flex; gap:3px; border:1px solid var(--border); border-radius:6px; background:#0a0d12; padding:2px}
    .typeBtn{flex:1; padding:5px 8px; font-size:10px; font-weight:600; border:none; border-radius:4px; cursor:pointer; background:transparent; color:var(--muted); transition:all .15s ease}
    .typeBtn.st{background:transparent; color:var(--muted)}
    .typeBtn.st.active{background:var(--accent-2); color:#fff}
    .typeBtn.zd{background:transparent; color:var(--muted)}
    .typeBtn.zd.active{background:var(--accent); color:#fff}
    .lessonRowActions{display:grid; grid-template-columns:1fr; gap:4px; justify-items:center}
    .lessonRowActions button{font-size:10px; padding:6px 12px;width: 100px; height:28px; background:linear-gradient(135deg,#4a4a4a,#2d2d2d); border:none; color:#e5e5e5; font-weight:600; border-radius:6px; cursor:pointer; transition:all .15s ease}
    .lessonRowActions button:hover{filter:brightness(1.1)}
    .lessonRowActions button:active{transform:scale(.98)}
    .addLessonBtn{background:rgba(93,215,239,.15); border:1px dashed var(--accent); color:var(--accent); padding:6px; border-radius:8px; cursor:pointer; font-size:10px; font-weight:600; transition:all .15s ease; margin-top:2px}
    .addLessonBtn:hover{background:rgba(93,215,239,.25)}

    .lessonPaymentCheck{display:flex; align-items:center}
    .paymentCheckbox{
      appearance:none; -webkit-appearance:none;
      width:14px; height:14px;
      padding:0;
      background-color:transparent;
      border:1.5px solid var(--border);
      border-radius:3px;
      cursor:pointer;
      position:relative;
      transition:all .2s ease;
      flex-shrink:0;
      margin:0;
    }
    .paymentCheckbox:checked{border-color:var(--accent); background-color:rgba(93,215,239,0.1)}
    .paymentCheckbox:disabled{opacity:1; cursor:default}
    .paymentCheckbox::after{
      content:""; 
      position:absolute;
      top:45%; left:50%;
      transform:translate(-50%, -50%) rotate(45deg);
      width:3px; height:7px;
      border:solid var(--accent);
      border-width:0 2px 2px 0;
      opacity:0; transition:opacity .2s ease;
    }
    .paymentCheckbox:checked::after{opacity:1}
    .lessonMetaRow{display:flex; align-items:center; gap:10px}
    
    /* DAY SELECTOR BUTTONS */
    .editPlanDayButton{background:#1a1e27; border:1px solid var(--border); color:var(--text); padding:10px 12px; border-radius:10px; cursor:pointer; font-weight:600; font-size:12px; transition:all .15s ease; text-align:center}
    .editPlanDayButton:hover{background:#1f2430; border-color:var(--accent)}
    .editPlanDayButton:active{transform:scale(.98)}
    .editPlanDayButton.today{background:rgba(93,215,239,.12); border:1px solid var(--accent); color:var(--accent)}
    .editPlanDayButton:last-child{grid-column:1/-1}
    .planEditFooter{display:flex; gap:8px; justify-content:center; flex-wrap:wrap}
    .planEditFooter button{padding:8px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:600; font-size:12px; transition:all .15s ease}
    .planEditFooter .btn{background:#1a1e27; border:1px solid var(--border); color:var(--text)}
    .planEditFooter .btn:hover{background:#1f2430}
    .planEditFooter .btn.primary{background:linear-gradient(145deg,#1a2847,#0f1626); color:var(--text); border:none}
    .planEditFooter .btn.ghost{background:transparent; color:var(--text); border:1px solid var(--border)}

    /* CALENDAR STYLES */
    .calendarHeader{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
    .calendarNav{width:32px; height:32px; border-radius:8px; border:1px solid var(--border); background:#1a1e27; color:var(--text); cursor:pointer; font-size:18px; font-weight:300; transition:all .15s ease; display:grid; place-items:center; padding:0}
    .calendarNav:hover{background:#1f2430; border-color:var(--accent)}
    .calendarNav:active{transform:scale(.95)}
    .calendarMonthYear{font-weight:700; font-size:14px; color:var(--text); text-align:center; letter-spacing:.3px; min-width:120px}
    .calendarWeekDays{display:grid; grid-template-columns:repeat(7,1fr); gap:4px; margin-bottom:8px; text-align:center}
    .calendarWeekDays div{font-size:11px; font-weight:600; color:var(--muted); padding:4px 0}
    .miniCalendar{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
    .miniCalendar button{padding:8px 4px; border-radius:6px; border:1px solid var(--border); background:#1a1e27; color:var(--muted); cursor:pointer; font-size:11px; font-weight:600; transition:all .15s ease; min-height:40px; width:100%; display:flex; align-items:center; justify-content:center}
    .miniCalendar button:hover{background:#1f2430; border-color:var(--accent)}
    .miniCalendar button:active{transform:scale(.95)}
    .miniCalendar button.other-month{opacity:0.25; pointer-events:none}
    .miniCalendar button.today{border:1px solid var(--accent); color:var(--accent); font-weight:700; background:rgba(93,215,239,.12)}
    .miniCalendar button.selected{background:linear-gradient(145deg,rgba(93,215,239,.25),rgba(93,215,239,.15)); border-color:var(--accent); color:var(--accent); font-weight:700}
    .miniCalendar button.in-range{background:rgba(93,215,239,.12); border-color:rgba(93,215,239,.35); color:var(--text)}
    .miniCalendar button.range-start,
    .miniCalendar button.range-end{background:linear-gradient(145deg,rgba(93,215,239,.35),rgba(93,215,239,.18)); border-color:var(--accent); color:var(--accent); font-weight:700}
    #timeOffCalendar button.today{background:transparent; border:1px solid rgba(255,255,255,.9); color:var(--text); font-weight:600}
    #timeOffCalendar button.today.range-start,
    #timeOffCalendar button.today.range-end{background:linear-gradient(145deg,rgba(93,215,239,.35),rgba(93,215,239,.18)); border-color:var(--accent); color:var(--accent); font-weight:700}

    .timeOffInfo{background:linear-gradient(145deg,rgba(139,92,246,.14),rgba(110,231,255,.1)); border:1px solid rgba(139,92,246,.25); border-radius:14px; padding:10px 12px; display:flex; flex-direction:column; gap:4px; margin:-4px 0 14px}
    .timeOffLabel{font-size:11px; color:var(--muted); letter-spacing:.3px; text-transform:uppercase}
    .timeOffRangeLine{display:flex; align-items:baseline; gap:6px}
    .timeOffRange{font-weight:800; font-size:14px; color:var(--text)}
    .timeOffMeta{font-size:12px; color:var(--muted)}
    .timeOffMeta.inline{margin-left:8px; display:inline}

    .timeOffQuick{display:flex; flex-direction:column; gap:8px; background:#131722; border:1px solid var(--border); border-radius:12px; padding:10px}
    .timeOffQuick .row{display:grid; grid-template-columns:90px 1fr 1fr; gap:8px}
    .timeOffQuick .hint{font-size:11px; color:var(--muted)}
    .timeOffList{display:flex; flex-direction:column; gap:8px}
    .timeOffItem{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 10px; border:1px solid var(--border); border-radius:10px; background:#131722}
    .timeOffItem .meta{font-size:12px; color:var(--muted)}
    .dayCell.offDay{background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.18)}
    .dayCell.offDay::before{content:'‚òï'; position:absolute; top:2px; right:2px; font-size:10px}
    .dayCell.today.offDay{border:1px solid var(--accent); background:rgba(93,215,239,.12)}
    .dayCard.dayOff{border:1px solid rgba(255,255,255,.22); background:rgba(255,255,255,.06)}
    .dayCard.dayOff.today{border:1px solid var(--accent); background:rgba(93,215,239,.12)}
    .dayCard.dayOff.today .dayHeader{color:var(--accent)}
    .dayCard.dayOff.today .emptyLessonMsg{color:var(--accent)}

    /* SETTINGS MODAL */
    .settings-dialog-wrap{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:50}
    .settings-dialog{width:520px; max-width:92vw; background:#0f1218; border:1px solid var(--border); border-radius:18px; padding:20px; box-shadow:var(--shadow); max-height:90vh; overflow:auto}
    .settings-dialog h2{margin:0 0 16px 0; font-size:20px; color:var(--text)}
    .settings-section{margin-bottom:16px}
    .settings-section-title{font-size:13px; font-weight:700; color:var(--muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:10px; display:block}
    .settings-btn-group{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .settings-btn-group .btn{width:100%; display:flex; align-items:center; justify-content:center; gap:8px}

    /* STATS VIEW */
    .monthSelector{display:flex; align-items:center; justify-content:center; gap:16px; padding:12px 0; margin-bottom:12px}
    .monthNav{width:36px; height:36px; border-radius:10px; border:1px solid var(--border); background:#151821; color:var(--text); cursor:pointer; display:grid; place-items:center; transition:background .15s ease}
    .monthNav:hover{background:#1a1e27}
    .monthNav:active{transform:scale(.95)}
    .monthNav svg{width:18px; height:18px; fill:currentColor}
    .monthDisplay{font-weight:700; font-size:14px; color:var(--text); min-width:100px; text-align:center; letter-spacing:.3px; cursor:pointer; padding:6px 10px; border-radius:10px; transition:background .15s ease; user-select:none}
    .monthDisplay:hover{background:rgba(255,255,255,0.06)}

    /* Summary Grid */
    .summaryGrid{display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:16px}
    .summaryCard{background:linear-gradient(135deg,rgba(139,92,246,.15),rgba(110,231,255,.1)); border:1px solid var(--border); border-radius:14px; padding:14px 12px; text-align:center}
    .summaryCard:first-child{grid-column:1 / -1; width:100%}
    .summaryLabel{font-size:12px; color:var(--muted); font-weight:500; margin-bottom:6px; letter-spacing:.3px}
    .summaryAmount{font-weight:800; font-size:16px; color:var(--accent); letter-spacing:-.4px}
    .statBar{height:3px; background:var(--border); border-radius:2px; margin-top:8px; overflow:hidden}
    .statBarFill{height:100%; background:linear-gradient(90deg, var(--accent-2), var(--accent)); border-radius:2px; transition:width .3s ease}
    
    /* Chart */
    .chartWrapper{background:#0a0d13; border:1px solid var(--border); border-radius:14px; padding:20px 12px; margin-bottom:16px; min-height:160px; display:flex; align-items:center; justify-content:center}
    .chartWrapper canvas{width:100% !important; height:auto !important; max-height:180px}
    
    /* Separator */
    .statsSection{margin-top:4px}
    .statsHeader{display:flex; align-items:center; gap:10px; margin:6px 0; color:var(--text); font-weight:700; font-size:13px; letter-spacing:.2px; white-space:nowrap}
    .statsHeader::before, .statsHeader::after{content:''; height:1px; background:var(--border); flex:1}
    .statsHeader span{flex:0}
    .overdueList{display:flex; flex-direction:column; gap:0; padding-bottom:6px}
    .overdueItem{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:11px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:linear-gradient(135deg, rgba(139,92,246,.10), rgba(110,231,255,.06)); box-shadow:0 6px 16px rgba(0,0,0,.22); margin-bottom:8px}
    .overdueText{font-size:12px; font-weight:600; color:var(--text)}
    .overdueDismiss{height:22px; width:22px; border-radius:6px; border:none; background:transparent; color:rgba(154,163,173,.8); cursor:pointer; font-weight:700; display:grid; place-items:center; line-height:1; font-size:12px}
    .overdueDismiss:hover{background:rgba(255,255,255,.06); color:rgba(154,163,173,.95)}

    /* Empty State */
    .emptyState{border:1px solid var(--border); border-radius:16px; padding:24px; background:#0f1218; cursor:default; display:flex; justify-content:center; align-items:center; text-align:center; color:var(--muted); font-size:14px; pointer-events:none; user-select:none; line-height:1.6}

    /* Student Count */
    .studentCount{text-align:center; color:var(--muted); font-size:13px; padding:8px 0 12px 0; margin-bottom:4px; font-weight:500}
    
    /* Annual Summary Section */
    .annualSummaryWrap{margin-bottom:16px}
    .annualSummaryHeader{display:flex; align-items:center; gap:10px; margin-bottom:12px; color:var(--text); font-weight:700; font-size:13px; letter-spacing:.2px; white-space:nowrap}
    .annualSummaryHeader::before, .annualSummaryHeader::after{content:''; height:1px; background:var(--border); flex:1}
    .annualSummaryHeader span{flex:0}
    .annualSummaryGrid{display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:16px}
    .annualCard{background:linear-gradient(135deg,rgba(110,231,255,.12),rgba(139,92,246,.12)); border:1px solid var(--border); border-radius:14px; padding:12px; text-align:center}
    .annualCard .summaryLabel{font-size:11px; color:var(--muted); font-weight:500; margin-bottom:6px; letter-spacing:.3px}
    .annualCard .summaryAmount{font-weight:800; font-size:14px; color:var(--accent); letter-spacing:-.4px}

    @media (max-width:600px){
      .weekContainer{gap:6px; padding:0 2px}
      .dayCard{grid-template-columns:65px 1fr; gap:8px; padding:10px}
      .dayHeader{font-size:12px; padding:2px 0}
      .lessonItem{font-size:10px; padding:6px 8px}
      .footer{gap:6px}
      .btn{height:40px; padding:0 12px; font-size:13px; flex:1}
      .btn.primary, .btn.ghost, .btn.danger{flex:1; min-width:0}
    }
    @media (max-width:440px){ .phone{width:100%; height:calc(100vh - 48px)} }
    
    /* --- Display-Mode (installed PWA) --- */
    @media (display-mode: standalone), (display-mode: fullscreen) {
      body{ padding:0; }
      .phone{ width:100vw; height:100dvh; border-radius:0; padding:0; border:0; box-shadow:none; }
      .notch{ display:none; }
      .screen{ border:0; border-radius:0; padding: calc(12px + env(safe-area-inset-top)) 12px calc(16px + env(safe-area-inset-bottom)) 12px; }
    }

    /* --- Mobile fullscreen mode (hide mockup chrome, respect notches) --- */
    @media (max-width: 600px), (pointer: coarse) {
      .phone{ width:100vw; height:100dvh; border-radius:0; padding:0; border:0; box-shadow:none; }
      .notch{ display:none; }
      .screen{ border:0; border-radius:0; padding: calc(12px + env(safe-area-inset-top)) 12px calc(16px + env(safe-area-inset-bottom)) 12px; }
      .fab{ right: calc(16px + env(safe-area-inset-right)); bottom: calc(16px + env(safe-area-inset-bottom)); }
      .copyright{ padding-bottom: calc(6px + env(safe-area-inset-bottom)); }
      .map{ height: 280px; }
      /* Dialog fullscreen with internal scroll so content is always reachable */
      .dialog-wrap{ align-items:stretch; justify-content:stretch; }
      .dialog{ width:100vw; max-width:100vw; height:100dvh; max-height:100dvh; border-radius:0; overflow:auto; }
      .dialog .footer{ position:sticky; bottom:0; background:#0f1218; padding-top:8px; padding-bottom: calc(10px + env(safe-area-inset-bottom)); border-top:1px solid var(--border); }
    }

    @media (max-width: 600px), (pointer: coarse) {
      #incomeDialogWrap{ align-items:center; justify-content:center; padding:16px 12px; }
      #incomeDialogWrap .dialog{ width:100%; max-width:520px; height:auto; max-height:80dvh; border-radius:16px; }
    }
  </style>
</head>
<body>

  <!-- SPLASH SCREEN -->
  <div class="splash" id="splash">
    <div class="splash-logo">Tuttorly</div>
  </div>

  <div class="phone" id="phone">
    <div class="notch"></div>
    <div class="screen">
      <div class="appbar">
                <div class="appbar-left">
          <div class="iconbtn ghost" id="supportBtn" title="Wesprzyj projekt">
            <svg viewBox="0 0 24 24"><path d="M7.5 16L3 12l4.5-4 1 1L5.5 12l3 3-1 1zm9-8l4.5 4-4.5 4-1-1 3-3-3-3 1-1zM14.2 4l-3 16h-1.4l3-16h1.4z" fill="currentColor"/></svg>
          </div>
        </div>

        <div class="appbar-center">
          <div class="title">Tuttorly</div>
        </div>
        <div class="appbar-right">
          <div class="iconbtn ghost" id="settingsBtn" title="Ustawienia">
            <svg viewBox="0 0 24 24"><path d="M19.14,12.94a7.43,7.43,0,0,0,.05-.94,7.43,7.43,0,0,0-.05-.94l2.11-1.65a.5.5,0,0,0,.12-.64l-2-3.46a.5.5,0,0,0-.6-.22l-2.49,1a7.26,7.26,0,0,0-1.63-.94l-.38-2.65A.5.5,0,0,0,13.72,1H10.28a.5.5,0,0,0-.49.41L9.41,4.06a7.26,7.26,0,0,0-1.63.94l-2.49-1a.5.5,0,0,0-.6.22l-2,3.46a.5.5,0,0,0,.12.64L3.86,11.06a7.43,7.43,0,0,0-.05.94,7.43,7.43,0,0,0,.05.94L1.75,14.59a.5.5,0,0,0-.12.64l2,3.46a.5.5,0,0,0,.6.22l2.49-1a7.26,7.26,0,0,0,1.63.94l.38,2.65a.5.5,0,0,0,.49.41h3.44a.5.5,0,0,0,.49-.41l.38-2.65a7.26,7.26,0,0,0,1.63-.94l2.49,1a.5.5,0,0,0,.6-.22l2-3.46a.5.5,0,0,0-.12-.64ZM12,15.5A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z" fill="currentColor"/></svg>
          </div>
        </div>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>

      <!-- NAVIGATION TABS -->
      <div class="tabs">
        <div class="tab" id="terminyTab" data-view="terminy">Terminy</div>
        <div class="tab active" id="studentsTab" data-view="students">Uczniowie</div>
        <div class="tab" id="statsTab" data-view="stats">Statystyki</div>
      </div>

      <!-- CALENDAR VIEW -->
      <div class="view" id="terminyView">
        <!-- Week Schedule -->
        <h3 style="color:#fff; margin:12px 0 16px; letter-spacing:.3px; font-size:17px; text-align:center; background:linear-gradient(145deg, rgba(139,92,246,.15), rgba(110,231,255,.12)); padding:12px 20px; border-radius:14px; display:inline-block; width:100%; border:1px solid rgba(139,92,246,.2)">Plan Tego Tygodnia</h3>
        <div class="timeOffInfo" id="nextTimeOffInfo" style="display:none">
          <div class="timeOffLabel">‚òï Najbli≈ºsze wolne</div>
          <div class="timeOffRangeLine">
            <span class="timeOffRange" id="nextTimeOffRange">‚Äî</span>
            <span class="timeOffMeta inline" id="nextTimeOffMeta"></span>
          </div>
        </div>
        <div class="weekContainer" id="weekContainer"></div>
        
        <!-- Action Buttons -->
        <div class="terminyActions">
          <button class="terminyBtn" id="editStaticPlanBtn">üìã Edytuj plan sta≈Çy</button>
          <button class="terminyBtn" id="addTimeOffBtn">‚òï Dni wolne</button>
          <button class="terminyBtn" id="addTempChangeBtn" style="display:none">‚ûï Dodaj zmianƒô</button>
        </div>

        <!-- Monthly Calendar -->
        <div class="monthCalendarWrap">
          <div class="monthHeader">
            <button class="monthNavBtn" id="prevMonthCal">‚Äπ</button>
            <div class="monthTitle" id="monthTitleCal">2025 Pa≈∫</div>
            <button class="monthNavBtn" id="nextMonthCal">‚Ä∫</button>
          </div>
          <div class="weekDaysHeader">
            <div class="dayHeader">PON.</div>
            <div class="dayHeader">WT.</div>
            <div class="dayHeader">≈öR.</div>
            <div class="dayHeader">CZW.</div>
            <div class="dayHeader">PT.</div>
            <div class="dayHeader">SOB.</div>
            <div class="dayHeader">NIEDZ.</div>
          </div>
          <div class="monthGrid" id="monthGrid"></div>
        </div>
      </div>

      <!-- STUDENTS VIEW -->
      <div class="view active" id="studentsView">
        <div class="list" id="listView"></div>
      </div>

      <!-- STATS VIEW -->
      <div class="view" id="statsView">
        <!-- Month Selector -->
        <div class="monthSelector">
          <button class="monthNav" id="prevMonth" title="Poprzedni miesiƒÖc">
            <svg viewBox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </button>
          <div class="monthDisplay" id="monthDisplay">pa≈∫dziernik 2025</div>
          <button class="monthNav" id="nextMonth" title="Nastƒôpny miesiƒÖc">
            <svg viewBox="0 0 24 24"><path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
          </button>
        </div>

        <!-- Summary Cards -->
        <div class="summaryGrid">
          <div class="summaryCard">
            <div class="summaryLabel">Razem</div>
            <div class="summaryAmount" id="totalAmount">0 z≈Ç</div>
          </div>
          <div class="summaryCard">
            <div class="summaryLabel">üåê Karta</div>
            <div class="summaryAmount" id="onlineAmount">0 z≈Ç</div>
            <div class="statBar"><div class="statBarFill" id="onlineBar"></div></div>
          </div>
          <div class="summaryCard">
            <div class="summaryLabel">üíµ Got√≥wka</div>
            <div class="summaryAmount" id="cashAmount">0 z≈Ç</div>
            <div class="statBar"><div class="statBarFill" id="cashBar"></div></div>
          </div>
        </div>

        <!-- Annual Summary Section -->
        <div class="annualSummaryWrap">
          <div class="annualSummaryHeader">
            <span>Podsumowanie roczne</span>
          </div>
          <div class="annualSummaryGrid">
            <div class="annualCard">
              <div class="summaryLabel">Razem</div>
              <div class="summaryAmount" id="annualTotal">0 z≈Ç</div>
            </div>
            <div class="annualCard">
              <div class="summaryLabel">üåê Karta</div>
              <div class="summaryAmount" id="annualOnline">0 z≈Ç</div>
            </div>
            <div class="annualCard">
              <div class="summaryLabel">üíµ Got√≥wka</div>
              <div class="summaryAmount" id="annualCash">0 z≈Ç</div>
            </div>
          </div>
        </div>

        <!-- Earnings Chart -->

        <div class="chartWrapper">
          <canvas id="earningsChart"></canvas>
        </div>

        <!-- Separator with header -->
        <div class="statsSection">
          <div class="statsHeader" id="overdueHeader" style="display:none">
            <span>Zaleg≈Çe wp≈Çaty</span>
          </div>
          <div class="overdueList" id="overdueList" style="display:none"></div>
          <div class="statsHeader">
            <span>Historia wp≈Çat</span>
          </div>
        </div>

        <!-- Earnings List -->
        <div class="list" id="earningsList"></div>
      </div>

      <!-- DETAIL VIEW -->
      <div class="detail readonly" id="detailView">
        <!-- top row with actions -->
        <div class="detailTop">
          <div class="iconbtn primary" id="inlineBack" title="Wr√≥ƒá">
            <svg viewBox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </div>
          <div style="flex:1"></div>
          <div class="iconbtn primary" id="editBtn" title="Edytuj ucznia">
            <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/></svg>
          </div>
        </div>

        <!-- Avatar -->
        <div class="center-avatar"><div class="avatar big" id="dAvatar"></div></div>

        <!-- Name -->
        <div class="row"><input id="dName" placeholder="Imiƒô i nazwisko" style="max-width:280px; text-align:center" /></div>

        <!-- Subject/Class (previously place) - HIDDEN in view mode -->
        <div class="row" style="display:none"><input id="dPlace" placeholder="Przedmiot, klasa" style="max-width:280px; text-align:center" /></div>

        <!-- Expandable Notes -->
        <div class="notesExpandable" id="notesToggle" style="max-width:280px; display:none">
          <pre class="notesContent" id="dNotesDisplay"></pre>
        </div>
        <textarea id="dNotes" placeholder="Notatki o uczniu" style="display:none"></textarea>

        <!-- Balance -->
        <div id="balanceWrap" class="balanceWrap" style="max-width:280px; margin:0 auto; flex-direction:column; justify-content:center">
          <div class="balanceLine">
            <span class="balanceLabel">Wymagana kwota:</span>
            <span id="dRequired" class="requiredAmount">0 z≈Ç</span>
          </div>
          <div class="balanceLine">
            <span class="balanceLabel">Bilans:</span>
            <span id="dBalance" class="amount" style="font-size:18px; font-weight:900">0 z≈Ç</span>
          </div>
          <span id="freeBadge" class="badge" style="display:none; margin-left:0; margin-top:8px">Darmowa lekcja</span>
        </div>

        <!-- Action Buttons -->
        <div class="actions" style="max-width:280px">
          <button class="btn ok" id="plus10">+10 z≈Ç</button>
          <button class="btn bad" id="minus10">‚àí10 z≈Ç</button>
          <button class="btn ghost" id="resetBtn" title="Wyzeruj saldo">Wyzeruj</button>
        </div>

        <!-- Amount Buttons -->
        <div class="actions amountRow" style="max-width:280px">
          <button class="btn ok padfix" id="addPlus">+ kwota</button>
          <button class="btn bad padfix" id="addMinus">‚àí kwota</button>
          <input id="customAmount" type="number" placeholder="Custom" />
        </div>

        <!-- Active & Price -->
        <div class="row" id="activeRowView" style="max-width:280px">
          <div class="badge activePriceBadge" style="flex:1">
            <div id="activeBadge">Zdalne: 60 min</div>
            <div id="priceBadge">Cena: ‚Äî</div>
          </div>
        </div>

        <!-- Location -->
        <div class="row" style="max-width:280px">
          <div class="inputIconWrap">
            <span class="inputIcon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M3 11.5 12 4l9 7.5"/>
                <path d="M6 10.5V20h12v-9.5"/>
                <path d="M10 20v-6h4v6"/>
              </svg>
            </span>
            <input id="dLocation" class="inputWithIcon" placeholder="Miejsce (miasto)" style="text-align:center" />
          </div>
        </div>

        <!-- Map Button -->
        <div class="row" style="margin-top: 12px; max-width:280px">
          <button class="btn" id="toggleMapBtn" style="width:100%">Poka≈º mapƒô</button>
        </div>
        <div class="map-wrap" style="display: none;"><iframe class="map" id="map" loading="lazy" referrerpolicy="no-referrer-when-downgrade" allowfullscreen></iframe></div>
      </div>

      <button class="fab" id="addBtn" title="Dodaj ucznia">+</button>
    </div>
  </div>

  <!-- DIALOG -->
  <div class="dialog-wrap" id="dialogWrap">
    <div class="dialog">
      <h3 id="dialogTitle">Nowy ucze≈Ñ</h3>
      <div class="row"><input id="sName" placeholder="Imiƒô i nazwisko" /></div>
      <div class="row"><input id="sPlace" placeholder="Miejsce (miasto, ulica)" /></div>
      <div class="row"><textarea id="sNotes" placeholder="Notatki"></textarea></div>

      <h3 style="margin-top:8px">Media</h3>
      <div class="row">
        <div id="avatarUpload" class="upload">
          <div id="avatarPreview" class="avatar big"></div>
          <div class="sp">
            <div class="name">Avatar (opcjonalnie)</div>
            <div id="avatarHint" class="hint">PNG/JPG ‚Äî kliknij, aby wybraƒá</div>
          </div>
          <button type="button" id="avatarPick" class="mini btn primary">Wybierz</button>
        </div>
        <input type="file" id="sAvatar" accept="image/*" style="display:none" />
        <b id="avatarInfo" style="display:none">(opcjonalnie)</b>
      </div>

      <h3 style="margin-top:8px">Cennik (PLN)</h3>
      <div style="display:flex; align-items:center; justify-content:center; gap:16px; margin-bottom:8px; padding:0 8px">
        <div style="font-weight:600; font-size:13px; color:var(--muted); text-align:center; flex:1">ZDALNE</div>
        <div style="font-weight:600; font-size:13px; color:var(--muted); text-align:center; width:80px"></div>
        <div style="font-weight:600; font-size:13px; color:var(--muted); text-align:center; flex:1">STACJONARNE</div>
      </div>
      <div style="display:flex; flex-direction:column; gap:10px">
        <div style="display:flex; align-items:center; justify-content:center; gap:16px">
          <input class="price" id="priceR60" type="number" placeholder="60" style="flex:1; text-align:center" />
          <span style="font-size:13px; color:var(--muted); text-align:center; width:80px; font-weight:600">‚Äî 60 min ‚Äî</span>
          <input class="price" id="priceS60" type="number" placeholder="70" style="flex:1; text-align:center" />
        </div>
        <div style="display:flex; align-items:center; justify-content:center; gap:16px">
          <input class="price" id="priceR90" type="number" placeholder="90" style="flex:1; text-align:center" />
          <span style="font-size:13px; color:var(--muted); text-align:center; width:80px; font-weight:600">‚Äî 90 min ‚Äî</span>
          <input class="price" id="priceS90" type="number" placeholder="100" style="flex:1; text-align:center" />
        </div>
        <div style="display:flex; align-items:center; justify-content:center; gap:16px">
          <input class="price" id="priceR120" type="number" placeholder="120" style="flex:1; text-align:center" />
          <span style="font-size:13px; color:var(--muted); text-align:center; width:80px; font-weight:600">‚Äî 120 min ‚Äî</span>
          <input class="price" id="priceS120" type="number" placeholder="140" style="flex:1; text-align:center" />
        </div>
      </div>

      <h3 style="margin-top:8px">Aktywne zajƒôcia (domy≈õlne)</h3>
      <div class="row">
        <select id="activeType">
          <option value="remote">Zdalne</option>
          <option value="station">Stacjonarne</option>
        </select>
        <select id="activeDur">
          <option value="60">60 min</option>
          <option value="90">90 min</option>
          <option value="120">120 min</option>
        </select>
      </div>

      <div class="footer">
        <button class="btn danger" id="deleteBtn" style="display:none">Usu≈Ñ ucznia</button>
        <div class="footerRight">
          <button class="btn ghost" id="cancelDialog">Anuluj</button>
          <button class="btn primary" id="confirmDialog">Zapisz</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CONFIRM DELETE MODAL -->
  <div class="dialog-wrap" id="confirmWrap" style="display:none">
    <div class="dialog">
      <h3>UsunƒÖƒá ucznia?</h3>
      <p id="confirmText" class="muted">Tej operacji nie mo≈ºna cofnƒÖƒá.</p>
      <div class="footer">
        <div></div>
        <div class="footerRight">
          <button class="btn ghost" id="confirmCancel">Anuluj</button>
          <button class="btn danger" id="confirmDelete">Usu≈Ñ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- INCOME ENTRY MODAL -->
  <div class="dialog-wrap" id="incomeDialogWrap">
    <div class="dialog" style="display:flex; flex-direction:column">
      <h3 id="incomeDialogTitle">Nowy wpis dochod√≥w</h3>
      
      <div class="row"><input id="incomeAmount" type="number" placeholder="Kwota (PLN)" step="0.01" inputmode="decimal" /></div>
      
      <div class="incomeTypeSelector">
        <button type="button" class="incomeTypeBtn active" data-type="cash">üíµ Got√≥wka</button>
        <button type="button" class="incomeTypeBtn" data-type="online">üåê Online</button>
      </div>
      <input id="incomeType" type="hidden" value="cash" />
      
      <div class="row"><input id="incomeDate" type="date" /></div>
      <div class="row">
        <div class="studentPicker" id="incomeStudentPicker">
          <input id="incomeStudentSearch" class="studentPickerInput" type="text" placeholder="Wyszukaj ucznia (min. 2 litery)" />
          <div class="studentPickerList" id="incomeStudentSuggestions"></div>
          <div class="selectedStudents" id="incomeSelectedList"></div>
        </div>
      </div>
      <div class="row"><input id="incomeNote" type="text" placeholder="Dopisek (opcjonalnie)" /></div>
      
      <div class="footer" style="margin-top:auto">
        <button class="btn danger" id="incomeDeleteBtn" style="display:none">Usu≈Ñ</button>
        <div class="footerRight">
          <button class="btn ghost" id="incomeCancelBtn">Anuluj</button>
          <button class="btn primary" id="incomeConfirmBtn">Zapisz</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MONTH SELECTOR MODAL -->
  <div class="dialog-wrap" id="monthSelectorWrap" style="display:none">
    <div class="dialog" style="padding:0; max-width:320px; display:flex; flex-direction:column">
      <div class="monthSelectorHeader">
        <div style="font-weight:700">Wybierz miesiƒÖc</div>
        <div class="yearDisplay" id="yearDisplay" onclick="openYearSelector()">2025</div>
      </div>
      <div id="monthSelectorGrid" style="padding:12px; display:grid; grid-template-columns:repeat(3,1fr); gap:8px; max-height:300px; overflow:auto; flex:1"></div>
      <div style="padding:12px; border-top:1px solid var(--border)">
        <button class="goTodayBtn" onclick="goToToday()">üìÖ Kliknij tutaj aby powr√≥ciƒá do dzisiaj</button>
      </div>
    </div>
  </div>

  <!-- YEAR SELECTOR MODAL -->
  <div class="yearSelectorWrap" id="yearSelectorWrap">
    <div class="yearDropdown" id="yearDropdown"></div>
  </div>
  <!-- SUPPORT MODAL -->
<div class="settings-dialog-wrap" id="supportDialogWrap">
  <div class="settings-dialog">
    <h2>Wsparcie projektu Tuttorly</h2>
<p style="color:var(--muted); margin:16px 0; line-height:1.6">
  Ej, spoko ≈ºe tutaj trafi≈Çe≈õ! üòä<br><br>
  Wiem, ≈ºe proszenie o wsparcie potrafi byƒá trochƒô wkurzajƒÖce, ale szczerze ‚Äì je≈õli aplikacja Ci siƒô spodoba≈Ça, by≈Çoby mi naprawdƒô mi≈Ço gdyby≈õ zrobi≈Ç chocia≈º jednƒÖ z poni≈ºszych rzeczy. To nic wielkiego, ale dla mnie wiele znaczy!<br><br>
  Je≈õli zdecydujesz siƒô spr√≥bowaƒá ‚Äì bƒôdƒô Ci bardzo wdziƒôczny. üôè<br><br>
  <strong>Mi≈Çego dnia!</strong><br>
  <em>~SimmSoft</em>
</p>
    <div class="settings-section">
      <span class="settings-section-title">Formy wsparcia</span>
      <div style="display:flex; flex-direction:column; gap:12px; margin-top:12px">

        <a href="https://paypal.me/SimmSoft" target="_blank" style="text-decoration:none">
          <div style="padding:12px; background:#1a1e27; border-radius:8px; border-left:3px solid var(--accent)">
            <strong style="color: white;">PayPal</strong>
            <p style="color:var(--muted); font-size:12px; margin:8px 0 0">
              Jednorazowe wsparcie przez PayPal.
            </p>
          </div>
        </a>

        <a href="https://play.google.com/store/apps/dev?id=7458095342590866317" target="_blank" style="text-decoration:none">
          <div style="padding:12px; background:#1a1e27; border-radius:8px; border-left:3px solid var(--accent-2)">
        <strong style="color: white;"> Google Play</strong>
            <p style="color:var(--muted); font-size:12px; margin:8px 0 0">
            Pobierz moje inne aplikacje na Sklep Play.
            </p>
          </div>
        </a>

        <a href="https://github.com/SimmSoft" target="_blank" style="text-decoration:none">
          <div style="padding:12px; background:#1a1e27; border-radius:8px; border-left:3px solid var(--ok)">
            <strong style="color: white;">GitHub</strong>
            <p style="color:var(--muted); font-size:12px; margin:8px 0 0">
              Zostaw gwiazdkƒô lub zg≈Çaszaj propozycje zmian.
            </p>
          </div>
        </a>

      </div>
    </div>

    <button class="btn primary" id="supportCloseBtn" style="width:100%; margin-top:16px">Zamknij</button>
  </div>
</div>


  <!-- SETTINGS MODAL -->
  <div class="settings-dialog-wrap" id="settingsDialogWrap">
    <div class="settings-dialog">
      <h2>‚öôÔ∏è Ustawienia</h2>
      
      <div class="settings-section">
        <span class="settings-section-title">ZarzƒÖdzanie danymi</span>
        <div class="settings-btn-group">
          <label class="btn primary" for="settingsImportFile" style="cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px">
            <svg viewBox="0 0 24 24" width="18" height="18"><path d="M19 12v7H5v-7H3v9h18v-9h-2zm-6 0 4-4-1.41-1.41L13 8.17V2h-2v6.17l-2.59-2.58L7 8l6 6z" fill="currentColor"/></svg>
            Importuj
          </label>
          <button class="btn primary" id="settingsExportBtn" style="display:flex; align-items:center; justify-content:center; gap:8px">
            <svg viewBox="0 0 24 24" width="18" height="18"><path d="M19 21H5v-7H3v9h18v-9h-2v7zM7 8l1.41 1.41L11 6.83V14h2V6.83l2.59 2.58L17 8l-5-5-5 5z" fill="currentColor"/></svg>
            Eksportuj
          </button>
          <input id="settingsImportFile" type="file" accept="application/json" style="display:none" />
        </div>
      </div>

      <div class="settings-section" style="border-top:1px solid var(--border); padding-top:16px; margin-top:16px">
        <span class="settings-section-title">Zamknij</span>
        <button class="btn ghost" id="settingsCloseBtn" style="width:100%">Anuluj</button>
      </div>
    </div>
  </div>

  <!-- INSTALL BAR -->
  <div id="installBar" class="installbar">
    <div class="logo" style="width:28px;height:28px">Tu</div>
    <div class="label" id="installText">Zainstaluj Tuttorly na ekranie g≈Ç√≥wnym.</div>
    <button id="installBtn" class="action">Zainstaluj</button>
    <div id="installClose" class="close">‚úï</div>
  </div>

  <!-- EDIT STATIC PLAN POPUP -->
  <div class="planEditWrap" id="editPlanWrap">
    <div class="planEditDialog">
      <h2>üìã Edytuj sta≈Çy plan zajƒôƒá</h2>
      
      <!-- Step 1: Day Selector -->
      <div id="editPlanStep1">
        <p style="color:var(--muted); margin:0 0 12px 0; font-size:13px">Krok 1: Wybierz dzie≈Ñ</p>
        <div id="editPlanDaySelector" style="display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin:12px 0"></div>
      </div>
      
      <!-- Step 2: Edit Lessons -->
      <div id="editPlanStep2" style="display:none">
        <p style="color:var(--muted); margin:0 0 12px 0; font-size:13px">Krok 2: Edytuj lekcje</p>
        <div class="dayColumnGrid" id="editPlanDayContainer"></div>
      </div>
      
      <div class="planEditFooter">
        <button class="btn ghost" id="editPlanCancel">Anuluj</button>
        <button class="btn ghost" id="editPlanBack" style="display:none">‚Üê Wr√≥ƒá</button>
        <button class="btn primary" id="editPlanSave" style="display:none">Zapisz</button>
      </div>
    </div>
  </div>

  <!-- ADD TEMP CHANGE POPUP -->
  <div class="planEditWrap" id="tempChangePlanWrap">
    <div class="planEditDialog">
      <h2>‚ûï Dodaj zmianƒô na dzie≈Ñ</h2>
      <div id="tempChangeStep1">
        <div class="calendarHeader">
          <button class="calendarNav" id="prevMonthBtn">‚Äπ</button>
          <div class="calendarMonthYear"><span id="calendarMonth"></span> <span id="calendarYear"></span></div>
          <button class="calendarNav" id="nextMonthBtn">‚Ä∫</button>
        </div>
        <div class="calendarWeekDays">
          <div>Pon</div><div>Wto</div><div>≈öro</div><div>Czw</div><div>PiƒÖ</div><div>Sob</div><div>Nie</div>
        </div>
        <div class="miniCalendar" id="miniCalendar"></div>
      </div>
      <div id="tempChangeStep2" style="display:none">
        <p style="color:var(--muted); margin:0 0 12px 0; font-size:13px">Krok 2: Edytuj plan dla wybranego dnia</p>
        <div class="dayColumnGrid" id="tempChangeDayContainer"></div>
      </div>
      <div class="planEditFooter">
        <button class="btn ghost" id="tempChangeCancelBtn" data-step1="Anuluj" data-step2="‚Üê Wr√≥ƒá">Anuluj</button>
        <button class="btn primary" id="tempChangeSaveBtn" style="display:none">Zapisz zmianƒô</button>
      </div>
    </div>
  </div>

  <!-- TIME OFF RANGE POPUP -->
  <div class="planEditWrap" id="timeOffWrap">
    <div class="planEditDialog">
      <h2 class="timeOffTitle">Dni wolne</h2>
      <div class="timeOffQuick">
        <div class="row">
          <input id="timeOffLength" type="number" min="1" placeholder="np. 7" />
          <select id="timeOffUnit">
            <option value="days">dni</option>
            <option value="weeks">tygodnie</option>
            <option value="months">miesiƒÖce</option>
          </select>
          <button class="btn primary" id="timeOffApplyLength">Ustaw od startu</button>
        </div>
        <div class="hint">Zakres liczony ≈ÇƒÖcznie z dniem startu.</div>
      </div>

      <div class="row">
        <input id="timeOffStart" type="date" />
        <input id="timeOffEnd" type="date" />
      </div>

      <div class="calendarHeader">
        <button class="calendarNav" id="timeOffPrevMonth">‚Äπ</button>
        <div class="calendarMonthYear"><span id="timeOffMonth"></span> <span id="timeOffYear"></span></div>
        <button class="calendarNav" id="timeOffNextMonth">‚Ä∫</button>
      </div>
      <div class="calendarWeekDays">
        <div>Pon</div><div>Wto</div><div>≈öro</div><div>Czw</div><div>PiƒÖ</div><div>Sob</div><div>Nie</div>
      </div>
      <div class="miniCalendar" id="timeOffCalendar"></div>

      <div class="divider"><span>Aktualne wolne</span></div>
      <div class="timeOffList" id="timeOffList"></div>

      <div class="planEditFooter">
        <button class="btn ghost" id="timeOffCancelBtn">Anuluj</button>
        <button class="btn primary" id="timeOffSaveBtn">Zapisz wolne</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
